<?php
/**
 * –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –±–ª–æ–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ò—Å—Ç–æ—Ä–∏—è"
 * 
 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
 * php clean-history-page-blocks.php
 * 
 * –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –±–ª–æ–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è —á–∏—Å—Ç–æ–π –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
 * 
 * @package Arsenal
 */

// –ü–æ–¥–∫–ª—é—á–∏—Ç—å WordPress
require_once dirname( dirname( __FILE__ ) ) . '/wp-load.php';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ WordPress
if ( ! function_exists( 'get_the_ID' ) ) {
    die( "‚ùå –û—à–∏–±–∫–∞: WordPress –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω\n" );
}

/**
 * –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏
 */
class History_Page_Cleaner {

    public static function run() {
        echo "\n=== –û—á–∏—Å—Ç–∫–∞ –±–ª–æ–∫–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ò—Å—Ç–æ—Ä–∏—è ===\n\n";

        // 1. –ù–∞–π—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ò—Å—Ç–æ—Ä–∏—è
        $page = get_page_by_title( '–ò—Å—Ç–æ—Ä–∏—è' );
        if ( ! $page ) {
            $page = get_page_by_path( 'history' );
        }

        if ( ! $page ) {
            echo "‚ùå –û—à–∏–±–∫–∞: –°—Ç—Ä–∞–Ω–∏—Ü–∞ '–ò—Å—Ç–æ—Ä–∏—è' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞\n";
            echo "   –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º '–ò—Å—Ç–æ—Ä–∏—è' –∏–ª–∏ slug 'history'\n\n";
            return false;
        }

        $page_id = $page->ID;
        echo "‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: '{$page->post_title}' (ID: {$page_id})\n";
        echo "   –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞: " . strlen( $page->post_content ) . " —Å–∏–º–≤–æ–ª–æ–≤\n\n";

        // 2. –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        echo "üìã –¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã:\n";
        echo str_repeat( "-", 50 ) . "\n";
        echo substr( $page->post_content, 0, 200 );
        if ( strlen( $page->post_content ) > 200 ) {
            echo "...\n";
        }
        echo str_repeat( "-", 50 ) . "\n\n";

        // 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –±–ª–æ–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!\n";
        echo "   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≥–æ—Ç–æ–≤—ã –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–Ω–æ–≤–æ.\n\n";
        
        // –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
        // echo "–í–≤–µ–¥–∏—Ç–µ 'yes' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ Enter –¥–ª—è –æ—Ç–º–µ–Ω—ã): ";
        // $confirmation = trim( fgets( STDIN ) );
        // if ( strtolower( $confirmation ) !== 'yes' ) {
        //     echo "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞\n\n";
        //     return false;
        // }

        // –î–ª—è CLI: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º
        $confirmation = 'yes';
        
        if ( strtolower( $confirmation ) !== 'yes' ) {
            echo "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞\n\n";
            return false;
        }

        // 4. –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
        echo "üîÑ –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...\n";
        
        $update_result = wp_update_post( array(
            'ID'           => $page_id,
            'post_content' => '',
        ), true );

        if ( is_wp_error( $update_result ) ) {
            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: " . $update_result->get_error_message() . "\n\n";
            return false;
        }

        echo "‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –æ—á–∏—â–µ–Ω\n\n";

        // 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        $updated_page = get_post( $page_id );
        echo "‚úÖ –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏: " . strlen( $updated_page->post_content ) . " —Å–∏–º–≤–æ–ª–æ–≤\n\n";

        // 6. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        echo "üìå –î–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:\n";
        echo "   1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É WordPress\n";
        echo "   2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É '–ò—Å—Ç–æ—Ä–∏—è'\n";
        echo "   3. –í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ Gutenberg –Ω–∞–∂–º–∏—Ç–µ '+' –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –±–ª–æ–∫–∞\n";
        echo "   4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É '–ü–∞—Ç—Ç–µ—Ä–Ω—ã/Patterns'\n";
        echo "   5. –í—Å—Ç–∞–≤—å—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:\n";
        echo "      - –ò—Å—Ç–æ—Ä–∏—è –∫–ª—É–±–∞ - –ó–∞–≥–æ–ª–æ–≤–æ–∫\n";
        echo "      - –ò—Å—Ç–æ—Ä–∏—è –∫–ª—É–±–∞ - –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞\n";
        echo "      - –ò—Å—Ç–æ—Ä–∏—è –∫–ª—É–±–∞ - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è\n";
        echo "   6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É\n\n";

        echo "=== –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! ===\n\n";
        return true;
    }
}

// –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
History_Page_Cleaner::run();
